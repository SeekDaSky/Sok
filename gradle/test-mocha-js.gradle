task installDependenciesMochaNode(type: NpmTask, dependsOn: [npmInstall]) {
    args = ['install',
            "mocha@$mocha_version",
            "source-map-support@$source_map_support_version",
	    "kotlin@$kotlin_version",
	    "kotlinx-coroutines-core@$coroutine_version",
	    "kotlinx-atomicfu@$atomicFU_version",
	    "kotlin-test@$kotlin_version",
            '--no-save']
}

task testMochaNode(type: NodeTask, dependsOn: [compileTestKotlin2Js, installDependenciesMochaNode]) {
    script = file("$node.nodeModulesDir/mocha/bin/mocha")
    args = ["$node.nodeModulesDir/sok-js_test.js", '--require', 'source-map-support/register', "--timeout", "10000"]
}

test.dependsOn testMochaNode
